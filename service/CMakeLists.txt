IF(VEYON_BUILD_WIN32)

    ADD_DEFINITIONS(-DUNICODE -D_UNICODE)
	SET(WINRC "${CMAKE_CURRENT_BINARY_DIR}/veyon-service-rc.obj")
	ADD_CUSTOM_COMMAND(OUTPUT ${WINRC}
		                COMMAND ${WINDRES}
						    -I${CMAKE_CURRENT_SOURCE_DIR}
							-o${WINRC}
							-i${CMAKE_CURRENT_BINARY_DIR}/veyon-service.rc
						DEPENDS ${CMAKE_CURRENT_BINARY_DIR}/veyon-service.rc)

ENDIF()

IF(VEYON_BUILD_LINUX)
    CONFIGURE_FILE(${CMAKE_CURRENT_SOURCE_DIR}/veyon-service.service.in ${CMAKE_CURRENT_BINARY_DIR}/veyon-service.service @ONLY)
	INSTALL(FILES ${CMAKE_CURRENT_BINARY_DIR}/veyon-service.service DESTINATION /lib/systemd/system)
ENDIF()

INCLUDE_DIRECTORIES(${CMAKE_CURRENT_BINARY_DIR} ${CMAKE_CURRENT_SOURCE_DIR}/src)

ADD_EXECUTABLE(veyon-service ${CMAKE_CURRENT_SOURCE_DIR}/src/main.cpp ${WINRC})
TARGET_LINK_LIBRARIES(veyon-service veyon-core)

IF(VEYON_BUILD_WIN32)
    SET_TARGET_PROPERTIES(veyon-service PROPERTIES LINK_FLAGS -mwindows)
ENDIF()

INSTALL(TARGETS veyon-service RUNTIME DESTINATION bin)
